
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Putting them together in a pipeline &#8212; eKorpkit Tutorials</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/ekorpkit.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ESG (English)" href="../esg-en/index.html" />
    <link rel="prev" title="Preparing active learning data" href="prepare_datasets_for_labeling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FN4GFT8HP8"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-FN4GFT8HP8');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/ekorpkit.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">eKorpkit Tutorials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    eKonomic Research Python Toolkit
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/index.html">
   Getting started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/install.html">
     Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/usage.html">
     Usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/features/index.html">
   Key features
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/features/easy_config.html">
     Easy Configuration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/features/no_boiler.html">
     No Boilerplate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/features/workflows.html">
     Workflows
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/features/share.html">
     Sharable and Reproducible
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/features/plug.html">
     Pluggable Architece
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/config/index.html">
   Configuring ekorpkit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/config/eKonf.html">
     Using eKonf class
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/datasets/index.html">
   Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/corpora/corpus.html">
     Build and Load Corpora
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/datasets/dataset.html">
     Build and Load Datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/corpora/pipeline.html">
     Corpus task pipelines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/models/index.html">
   Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/models/automl/index.html">
     Auto ML
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/models/embeddings/index.html">
     Word Embeddings
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/embeddings/word2vec_basics.html">
       Word2Vec Basics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/embeddings/eval_vectors.html">
       Evaluate pretrained embeddings
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/models/ngram/index.html">
     N-Grams
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/ngram/ngram.html">
       N-Grams
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/ngram/ngram_for_lexicons.html">
       N-Gram model for ngram lexicon features
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/ngram/ngram_for_words.html">
       N-Gram model for unigram lexicon features
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/models/sentiment/index.html">
     Sentiment Analyers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/sentiment/lbsa_en.html">
       Lexicon-based Sentiment Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/sentiment/financial_phrasebank_lm.html">
       Evaluate LM with financial phrasebank
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/models/sentiment/sentiment.html">
       LM Dictionary vs. finbert vs. T5
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/models/transformers/index.html">
     Transformers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/pipelines/index.html">
   Pipelines
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/pipelines/pipeline.html">
     Instantiating pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/preprocessors/index.html">
   Preprocessors
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/preprocessors/normalizer/index.html">
     Normalizers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/preprocessors/normalizer/normalizer.html">
       Normalizers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/preprocessors/segmenter/index.html">
     Segmenters
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/preprocessors/segmenter/segmenter.html">
       Segmenters
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../tutorials/preprocessors/tokenizer/index.html">
     Tokenizers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../tutorials/preprocessors/tokenizer/mecab.html">
       Mecab Tokenizer
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/visualizers/index.html">
   Visualizers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/visualizers/plot.html">
     Plots
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tutorials/workflow/index.html">
   Workflows
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Datasets
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../corpus/ekorpkot_corpus.html">
   The eKorpkit Corpus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Use Cases
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../fomc/index.html">
   FOMC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/02_FOMC_numerical_data.html">
     Preparing Numerical Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/03_FOMC_corpus.html">
     Preparing Textual Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/04_FOMC_EDA_numericals.html">
     EDA on Numerical Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/05_FOMC_features.html">
     Visualizing Features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/06_FOMC_AutoML.html">
     Checking Baseline with AutoML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/07_FOMC_sentiments.html">
     Predicting Sentiments of FOMC Corpus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/08_FOMC_EDA_sentiments.html">
     EDA on Sentiment Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../fomc/09_FOMC_AutoML_with_tones.html">
     Predicting the next decisions with tones
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bok/index.html">
   Bank of Korea
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../edgar/index.html">
   EDGAR
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../edgar/predict_edgar.html">
     Prediciting Sentiments
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   ESG
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="prepare_datasets.html">
     Preparing training datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="improve_datasets.html">
     Improving classification datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="train_classifiers.html">
     Training Classifiers for ESG Ratings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="build_news_corpus.html">
     Building
     <code class="docutils literal notranslate">
      <span class="pre">
       econ_news_kr
      </span>
     </code>
     corpus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="predict_esg_classes.html">
     Predicting ESG Categories and Polarities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validate_datasets.html">
     Cross validating datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="prepare_datasets_for_labeling.html">
     Preparing active learning data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Putting them together in a pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../esg-en/index.html">
   ESG (English)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../esg-en/esg_corpus.html">
     Building
     <code class="docutils literal notranslate">
      <span class="pre">
       JOCo
      </span>
     </code>
     corpus
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cointax/index.html">
   Taxation on Cryptocurrency
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cointax/coin_dataset.html">
     Improving classification datasets
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Research
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../research/esg_topics/analyst.html">
   ESG Topic Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../research/esg_topics/rethink_esg.html">
   Rethinking ESG
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/nlp_intro/index.html">
   Introduction to NLP
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/ekorpkit.html">
     Getting started with ekorpkit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/research.html">
     Research Applications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/language_models.html">
     Language Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/topic.html">
     Topic Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/topic_models.html">
     Topic Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/topic_coherence.html">
     Topic Coherence Measures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/sentiments.html">
     Sentiment Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/tokenization.html">
     Tokenization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/word_segmentation.html">
     Word Segmentation and Association
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/vectorization.html">
     Vector Semantics and Representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/word_embeddings.html">
     Word Embeddings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/lab1-corpus.html">
     Lab 1: Preparing Wikipedia Corpora
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_intro/lab2-corpus-eda.html">
     Lab 2: EDA on Corpora
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/nlp_deep/index.html">
   Deep Learning for NLP
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/ekorpkit.html">
     Getting started with ekorpkit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/zeroshot.html">
     Zero Shot, Prompt, and Search Strategies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/bloom.html">
     What is BLOOM?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/bloom_apps.html">
     Bloom Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/transformers.html">
     Transformers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/bert.html">
     BERT: Bidirectional Encoder Representations from Transformers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/t5.html">
     T5: Text-To-Text Transfer Transformer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/tokenization.html">
     Tokenization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/sentencepiece.html">
     SentencePiece Tokenizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/byt5.html">
     ByT5: Towards a token-free future with pre-trained byte-to-byte models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/plms.html">
     Pretrained Language Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/lab1-corpus.html">
     Lab 1: Preparing Wikipedia Corpora
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/lab2-corpus-eda.html">
     Lab 2: EDA on Corpora
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/lab3-train-tokenizers.html">
     Lab 3: Training Tokenizers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/nlp_deep/lab4-pretraining-lms.html">
     Lab 4: Pretraining Language Models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/nlp_apps/index.html">
   NLP Applications
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/aiart/index.html">
   AI Art (Text-to-Image)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/intro.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/project-themes.html">
     Project Themes - A Brave New World
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/dalle1.html">
     DALL·E 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/dalle2.html">
     DALL·E 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/imagen.html">
     Imagen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/dalle-mini.html">
     DALL·E Mini
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/stable-diffusion.html">
     Stable Diffusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/prompt-generator.html">
     Prompt Generator for Stable Diffusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/textual-inversion.html">
     Textual Inversion (Dreambooth)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/whisper.html">
     Automatic Speech Recognition (Whisper)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/text2music.html">
     Text to Music
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/aiart/image2music.html">
     Image to Music
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../lectures/mlops/index.html">
   Machine Learning Systems Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/mlops/dev-env.html">
     Development Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../lectures/mlops/dotfiles.html">
     Dotfiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/ds/index.html">
   Data Science for Economics and Finance
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/index.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/cite.html">
   Citation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/entelecheia/ekorpkit-book/main?urlpath=tree/ekorpkit-book/docs/usecases/esg/all_in_one_pipeline.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/entelecheia/ekorpkit-book/blob/main/ekorpkit-book/docs/usecases/esg/all_in_one_pipeline.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/entelecheia/ekorpkit-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/entelecheia/ekorpkit-book/issues/new?title=Issue%20on%20page%20%2Fdocs/usecases/esg/all_in_one_pipeline.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/docs/usecases/esg/all_in_one_pipeline.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-additional-polarity-data">
   Preparing additional polarity data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-further-on-the-additional-polarity-data">
   Training further on the additional polarity data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-invalid-topic-data">
   Preparing invalid topic data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-an-invalid-topic-classifier">
   Training an invalid topic classifier
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter-out-invalid-topics">
     Filter out invalid topics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-further-on-the-additional-topic-data">
   Training further on the additional topic data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data-to-predict">
   Load data to predict
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-company-code-info">
   Load company code info
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-out-invalid-data">
   Filter out invalid data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predict-polarities">
   Predict polarities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predicting-categories">
   Predicting categories
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Putting them together in a pipeline</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-additional-polarity-data">
   Preparing additional polarity data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-further-on-the-additional-polarity-data">
   Training further on the additional polarity data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-invalid-topic-data">
   Preparing invalid topic data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-an-invalid-topic-classifier">
   Training an invalid topic classifier
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter-out-invalid-topics">
     Filter out invalid topics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-further-on-the-additional-topic-data">
   Training further on the additional topic data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data-to-predict">
   Load data to predict
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-company-code-info">
   Load company code info
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-out-invalid-data">
   Filter out invalid data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predict-polarities">
   Predict polarities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#predicting-categories">
   Predicting categories
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="putting-them-together-in-a-pipeline">
<h1>Putting them together in a pipeline<a class="headerlink" href="#putting-them-together-in-a-pipeline" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit</span> <span class="kn">import</span> <span class="n">eKonf</span>

<span class="k">if</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">is_colab</span><span class="p">():</span>
    <span class="n">eKonf</span><span class="o">.</span><span class="n">mount_google_drive</span><span class="p">()</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">set_workspace</span><span class="p">(</span>
    <span class="n">workspace</span><span class="o">=</span><span class="s2">&quot;/workspace&quot;</span><span class="p">,</span> 
    <span class="n">project</span><span class="o">=</span><span class="s2">&quot;ekorpkit-book/exmaples&quot;</span><span class="p">,</span> 
    <span class="n">task</span><span class="o">=</span><span class="s2">&quot;esg&quot;</span><span class="p">,</span> 
    <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;version:&quot;</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project_dir:&quot;</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>version: 0+unknown
project_dir: /workspace/projects/ekorpkit-book/exmaples
time: 1.01 s (started: 2022-12-29 10:48:36 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="section" id="preparing-additional-polarity-data">
<h2>Preparing additional polarity data<a class="headerlink" href="#preparing-additional-polarity-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.datasets.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;dataset=dataset&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;esg_polarity_kr&#39;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">data_dir</span>
<span class="n">ds_pol</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">data_files</span> <span class="o">=</span> <span class="n">ds_pol</span><span class="o">.</span><span class="n">data_files</span>
<span class="n">data_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Loaded info file: /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_polarity_kr/info-esg_polarity_kr.yaml
INFO:ekorpkit.info.column:index: index, index of data: index, columns: [&#39;id&#39;, &#39;text&#39;, &#39;labels&#39;, &#39;split&#39;], id: [&#39;id&#39;]
INFO:ekorpkit.info.column:Adding id [split] to [&#39;id&#39;]
INFO:ekorpkit.info.column:Added id [split], now [&#39;id&#39;, &#39;split&#39;]
INFO:ekorpkit.info.column:Added a column [split] with value [train]
INFO:ekorpkit.info.column:Added a column [split] with value [test]
INFO:ekorpkit.info.column:Added a column [split] with value [dev]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;train&#39;: &#39;esg_polarity_kr-train.parquet&#39;,
 &#39;test&#39;: &#39;esg_polarity_kr-test.parquet&#39;,
 &#39;dev&#39;: &#39;esg_polarity_kr-dev.parquet&#39;}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2.18 s (started: 2022-12-17 00:31:28 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pol_file</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/outputs/esg_polarity_labels/esg_polarity_labels(0)_export.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pol_file</span><span class="p">,</span> <span class="n">ds_pol</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
<span class="n">pol_data</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">pol_file</span><span class="p">)</span>
<span class="c1"># summary of labels column</span>
<span class="n">pol_data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.ekonf:copied /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_labels/esg_polarity_labels(0)_export.parquet to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_polarity_kr
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Neutral     622
Positive    437
Negative     99
Name: labels, dtype: int64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 18.7 ms (started: 2022-12-17 00:31:30 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="training-further-on-the-additional-polarity-data">
<h2>Training further on the additional polarity data<a class="headerlink" href="#training-further-on-the-additional-polarity-data" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">trained_model</span> <span class="o">=</span> <span class="s2">&quot;esg/models/esg_polarity-classification&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_further_train&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">ds_pol</span><span class="o">.</span><span class="n">data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">pol_file</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">1329829118</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">trained_model</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c1"># cfg.model.model_name_or_path = &quot;entelecheia/ekonelectra-base-discriminator&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-12-17 00:31:31.138429: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 6.7 s (started: 2022-12-17 00:31:30 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="n">sm</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.2
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 1329829118
INFO:ekorpkit.datasets.config:Train data: (926, 6)
INFO:ekorpkit.datasets.config:Test data: (232, 6)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_3_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2f53160b351749cca8e72bd12f10ca33", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:   Starting fine-tuning.
INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1d4685c9031e41c1b182920728aa06f1", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7f03388470ac4dd789e8de5bc9caf11e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ae1716af13fd41b48e8a437b5a673281", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "612e69592a254818a49ae2f94f4685d1", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b62d42ccd76c4f909097c7f61550caee", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "abd4082defff446b895887103d15ed04", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "535345ff4a084e3fa551d3da2fa6a6a3", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "391bb600ec334525b128ac0cdf0fabcf", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0c178b9a0e8647a3b370a8d09920bf60", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "aaa9b85b9cf644abac6100efa5475d33", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_polarity_further_train-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "05889887ee064c5fb7f059f0addda9de", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ed2f248c737748389063f25b7c6a5561", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.6891573875395348, &#39;acc&#39;: 0.8189655172413793, &#39;eval_loss&#39;: 0.4694342464208603}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_further_train/configs/esg_polarity_further_train(17)_config.yaml
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_polarity_further_train-classification/best_model
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "dae054868a9e4a68b9fde024ffecb3bd", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 2.34112883 -0.67941064 -1.39255905]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_further_train/esg_polarity_further_train(17)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy:  0.8448275862068966
Precison:  0.8644108938029865
Recall:  0.8448275862068966
F1 Score:  0.8501989907520767
Model Report: 
___________________________________________________
              precision    recall  f1-score   support

    Negative       0.54      0.83      0.65        18
     Neutral       0.84      0.86      0.85       113
    Positive       0.95      0.83      0.89       101

    accuracy                           0.84       232
   macro avg       0.78      0.84      0.80       232
weighted avg       0.86      0.84      0.85       232
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.visualize.base:Saved figure to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_further_train/esg_polarity_further_train(17)_confusion_matrix.png
</pre></div>
</div>
<img alt="../../../_images/all_in_one_pipeline_7_22.png" src="../../../_images/all_in_one_pipeline_7_22.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2min 3s (started: 2022-12-17 00:31:37 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pol_preds</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ds_pol</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pol_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_labels&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_probs&quot;</span><span class="p">]</span>
<span class="n">pol_preds</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 3 dataframes
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5a80b8eb31f24eae92a7275d634ea1ea", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 0.91535497 -1.61450195  0.57786864]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_further_train/esg_polarity_further_train(17)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13616, 7)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>labels</th>
      <th>pred_labels</th>
      <th>pred_probs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>헌법재판소는 먼저 고발권 행사의 재량성에 대해서는 공정거래법은 제71조에서 '......</td>
      <td>Negative</td>
      <td>Neutral</td>
      <td>0.557652</td>
    </tr>
    <tr>
      <th>1</th>
      <td>특히, 그룹내 업종도 다르고 재무구조도 다른 계열사들이 그룹으로 묶여지는 특수한 지...</td>
      <td>Neutral</td>
      <td>Neutral</td>
      <td>0.928248</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018년 신규 취업자수는 36만명 증가하고, 전체 취업자 증가율은 1.4%로 20...</td>
      <td>Neutral</td>
      <td>Neutral</td>
      <td>0.925551</td>
    </tr>
    <tr>
      <th>3</th>
      <td>앞서 분석한 대로 5월엔 펀더멘털 개선과 위험 요인들이 h지수의 방향을 좌우할 것이...</td>
      <td>Neutral</td>
      <td>Neutral</td>
      <td>0.896470</td>
    </tr>
    <tr>
      <th>4</th>
      <td>재생에너지의 성장 속도는 향후 10년 안에 세계 주요 지역의 전통 에너지원 (con...</td>
      <td>Positive</td>
      <td>Positive</td>
      <td>0.942311</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 49.9 s (started: 2022-12-17 00:33:40 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">records_with_label_error</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">find_label_errors</span><span class="p">(</span><span class="n">pol_preds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">records_with_label_error</span><span class="p">))</span>
<span class="n">records_with_label_error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Created 13616 records
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3124
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TextClassificationRecord(text=&#39;재생에너지는 태양 열, 태양광, 풍력, 수력(2003년 이후 10mw 이상의 대규모 수력발전 포함, 펌프 저장 수력 은 제외), 조력, 지열, 바이오, 폐기물로 구성되며, 바이오는 바이오가스, lfg(landfill gas), 바이오디젤, 우드 칩 &amp; 펠렛, 성형탄, 임산연료, 폐목재, 흑액, 하수슬러지 고형연 료, 바이오 srf(solid refuse fuel), 바이오 중유로 구성되고, 폐기물은 폐가스, 산업폐기물, 생활폐기물, 대형 도시 쓰레기, 시멘트 킬린 보조 연료, rdf(refuse-derived fuel), rpf(refuse plastic fuel), tdf(tire-derived fuel), srf, 정제 연료유, 폐목재로 구성되며, 신에너지는 연료전지와 igcc(integrated gasification combined cycle)을 포함한 다(에너지경제연구원, 2017)&#39;, inputs={&#39;text&#39;: &#39;재생에너지는 태양 열, 태양광, 풍력, 수력(2003년 이후 10mw 이상의 대규모 수력발전 포함, 펌프 저장 수력 은 제외), 조력, 지열, 바이오, 폐기물로 구성되며, 바이오는 바이오가스, lfg(landfill gas), 바이오디젤, 우드 칩 &amp; 펠렛, 성형탄, 임산연료, 폐목재, 흑액, 하수슬러지 고형연 료, 바이오 srf(solid refuse fuel), 바이오 중유로 구성되고, 폐기물은 폐가스, 산업폐기물, 생활폐기물, 대형 도시 쓰레기, 시멘트 킬린 보조 연료, rdf(refuse-derived fuel), rpf(refuse plastic fuel), tdf(tire-derived fuel), srf, 정제 연료유, 폐목재로 구성되며, 신에너지는 연료전지와 igcc(integrated gasification combined cycle)을 포함한 다(에너지경제연구원, 2017)&#39;}, prediction=[(&#39;Neutral&#39;, 0.029362538787583405), (&#39;Positive&#39;, 0.9645879337720511), (&#39;Negative&#39;, 0.006049527440365727)], prediction_agent=None, annotation=&#39;Neutral&#39;, annotation_agent=None, multi_label=False, explanation=None, id=None, metadata={&#39;id&#39;: 20632, &#39;split&#39;: &#39;train&#39;, &#39;label_error_candidate&#39;: 0}, status=&#39;Validated&#39;, event_timestamp=None, metrics=None, search_keywords=None)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 5.63 s (started: 2022-12-17 00:34:30 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove rows from preds that have label errors</span>
<span class="n">pol_preds_new</span> <span class="o">=</span> <span class="n">pol_preds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records_with_label_error</span><span class="p">:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">metadata</span>
    <span class="n">pol_preds_new</span> <span class="o">=</span> <span class="n">pol_preds_new</span><span class="p">[</span><span class="n">pol_preds_new</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pol_preds_new</span><span class="p">))</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_data_validated.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">pol_preds_new</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ds_pol</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_polarity_kr/esg_polarity_data_validated.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10492
time: 3.61 s (started: 2022-12-17 00:34:36 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_pol_merged</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">concat_data</span><span class="p">([</span><span class="n">pol_preds_new</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]],</span> <span class="n">pol_data</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_pol_merged</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_pol_merged</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Save data</span>
<span class="n">valid_pol_file</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_labels_validated.parquet&quot;</span>
<span class="n">valid_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/esg_polarity_validated&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">data_pol_merged</span><span class="p">,</span> <span class="n">valid_pol_file</span><span class="p">,</span> <span class="n">valid_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_polarity_validated/esg_polarity_labels_validated.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11650, 2)
Neutral     8744
Positive    2138
Negative     768
Name: labels, dtype: int64
time: 692 ms (started: 2022-12-17 00:34:39 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">trained_model</span> <span class="o">=</span> <span class="s2">&quot;esg/models/esg_polarity-classification&quot;</span>
<span class="n">valid_pol_file</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_labels_validated.parquet&quot;</span>
<span class="n">valid_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/esg_polarity_validated&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_validated&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">valid_data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">valid_pol_file</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">dev_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">1329829118</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">trained_model</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2.5 s (started: 2022-12-17 00:34:40 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="n">sm</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.2
INFO:ekorpkit.datasets.config:Splitting the dataframe into train and dev with ratio 0.2
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 1329829118
INFO:ekorpkit.datasets.config:Train data: (7456, 2)
INFO:ekorpkit.datasets.config:Test data: (2330, 2)
INFO:ekorpkit.datasets.config:Dev data: (1864, 2)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_3_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "088c1eeac4974f6ca712e7f9c7d9d2b5", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:   Starting fine-tuning.
INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6f2e2e92e9f14f589767fd5c4dd9599c", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d4fddb963349444c8811aa79376a4284", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8069432996637999, &#39;acc&#39;: 0.9125536480686696, &#39;eval_loss&#39;: 0.25196620722611746}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a1d168b3c754473dbf4e855f1b37870e", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8419274870938194, &#39;acc&#39;: 0.9350858369098712, &#39;eval_loss&#39;: 0.17219401597976686}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a9c5973612c24ae79b1f45d30e18da30", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8616681988721946, &#39;acc&#39;: 0.9431330472103004, &#39;eval_loss&#39;: 0.17937145059307416}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7dfd91a76ef24150a299c7bf829fea4d", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8164735813464941, &#39;acc&#39;: 0.9179184549356223, &#39;eval_loss&#39;: 0.28928871850172677}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4d59055dcbd540088aa72af52f56ee9e", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8320324459516233, &#39;acc&#39;: 0.924892703862661, &#39;eval_loss&#39;: 0.2821295350790024}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "3cb41a27e47c4c16bec1eccc92988aeb", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8287765741836166, &#39;acc&#39;: 0.9243562231759657, &#39;eval_loss&#39;: 0.3702389821410179}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c5730235766c41cdafd8402b45a791dc", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8184320449091033, &#39;acc&#39;: 0.9206008583690987, &#39;eval_loss&#39;: 0.37210700412591297}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "52ce155dcd634c49ac2c119a115a4bcc", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.823652825682142, &#39;acc&#39;: 0.9206008583690987, &#39;eval_loss&#39;: 0.3642778545618057}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1038529efba049c3863f4515fa9bbd90", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.848417005052376, &#39;acc&#39;: 0.9356223175965666, &#39;eval_loss&#39;: 0.30577353313565253}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "10b1085c5f87498983c85afd16813823", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8422222079477867, &#39;acc&#39;: 0.9318669527896996, &#39;eval_loss&#39;: 0.3222779060403506}
INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_polarity_validated-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_3_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "51ef84e670a342ffad045906ed01c465", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6e118c838d7f41949e61eff55b9b9a2d", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8446079311622469, &#39;acc&#39;: 0.9356223175965666, &#39;eval_loss&#39;: 0.306164560349364}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_validated/configs/esg_polarity_validated(4)_config.yaml
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_polarity_validated-classification/best_model
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "49720f49efff4cfc95ebc2cc19d50924", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 4.11547422 -1.68294871 -2.02361226]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_validated/esg_polarity_validated(4)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy:  0.9343347639484979
Precison:  0.9377720839698163
Recall:  0.9343347639484979
F1 Score:  0.9350573882693292
Model Report: 
___________________________________________________
              precision    recall  f1-score   support

    Negative       0.73      0.94      0.82       142
     Neutral       0.96      0.95      0.96      1760
    Positive       0.91      0.85      0.88       428

    accuracy                           0.93      2330
   macro avg       0.87      0.92      0.89      2330
weighted avg       0.94      0.93      0.94      2330
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.visualize.base:Saved figure to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_validated/esg_polarity_validated(4)_confusion_matrix.png
</pre></div>
</div>
<img alt="../../../_images/all_in_one_pipeline_13_32.png" src="../../../_images/all_in_one_pipeline_13_32.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 13min 42s (started: 2022-12-17 00:34:42 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="preparing-invalid-topic-data">
<h2>Preparing invalid topic data<a class="headerlink" href="#preparing-invalid-topic-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.datasets.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;dataset=dataset&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_kr&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">data_dir</span>
<span class="n">ds_inval</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_inval</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Loaded info file: /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_invalid_kr/info-esg_invalid_kr.yaml
INFO:ekorpkit.info.column:index: index, index of data: None, columns: [&#39;text&#39;, &#39;labels&#39;, &#39;annotation&#39;], id: [&#39;id&#39;]
INFO:ekorpkit.info.column:Adding id [split] to [&#39;id&#39;]
INFO:ekorpkit.info.column:Added id [split], now [&#39;id&#39;, &#39;split&#39;]
INFO:ekorpkit.info.column:Added a column [split] with value [train]
INFO:ekorpkit.info.column:Added a column [split] with value [dev]
INFO:ekorpkit.info.column:Added a column [split] with value [test]
INFO:ekorpkit.io.file:Concatenating 3 dataframes
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validated    198
Discarded    173
Name: labels, dtype: int64
time: 1.39 s (started: 2022-12-17 00:48:25 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/outputs/esg_topic_labels/esg_topic_labels(0)_export.parquet&quot;</span>
<span class="n">tp_add</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="c1"># summary of labels column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># change value of labels column</span>
<span class="c1"># UNKNOWN -&gt; Discarded</span>
<span class="c1"># Other values -&gt; Validated</span>
<span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Discarded&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;UNKNOWN&quot;</span> <span class="k">else</span> <span class="s2">&quot;Validated&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UNKNOWN             212
E-환경혁신               72
G-지배구조               66
G-기업윤리/불공정/소송        57
E-기후변화               53
S-기업(공급망)동반성장/상생     33
ESG                  24
S-고용                 20
S-소비자                14
S-사회공헌               11
S-재해/안전관리             9
E-환경영향                5
Name: labels, dtype: int64
Validated    364
Discarded    212
Name: labels, dtype: int64
time: 11.7 ms (started: 2022-12-17 00:48:27 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># combine two datasets</span>
<span class="n">data_inval</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">concat_data</span><span class="p">([</span><span class="n">ds_inval</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">tp_add</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_inval</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">data_inval</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># Save data</span>
<span class="n">file_inval</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_kr_merged.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">data_inval</span><span class="p">,</span> <span class="n">file_inval</span><span class="p">,</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 3 dataframes
INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_invalid_kr/esg_invalid_kr_merged.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validated    562
Discarded    385
Name: labels, dtype: int64
time: 114 ms (started: 2022-12-17 00:48:27 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="training-an-invalid-topic-classifier">
<h2>Training an invalid topic classifier<a class="headerlink" href="#training-an-invalid-topic-classifier" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>


<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_invalid_merged&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">file_inval</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="c1"># cfg.dataset.dev_size = 0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">3247616750</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s2">&quot;entelecheia/ekonelectra-base-discriminator&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">sm_inval</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 3.43 s (started: 2022-12-17 00:48:27 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_preds_inval</span> <span class="o">=</span> <span class="n">sm_inval</span><span class="o">.</span><span class="n">cross_val_predict</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dev_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.2
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 3247616750
INFO:ekorpkit.datasets.config:Train data: (757, 8)
INFO:ekorpkit.datasets.config:Test data: (190, 8)
INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.datasets.config:Train data: (631, 8)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6519de68c7d84e5c88d14f417fe1a1d8", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5d1d19630938424896c6e3fb42392394", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "eb491dbae60b4182938b8f07cd92fd33", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d4597a8de3eb41baa63ff9fd7da4a7c3", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "357b9a6d9f6441858e948e223451e16a", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2884b6a6ad52441c97ce079f3670e6ed", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a5f07c510a3442489256e056c95f0231", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8abee45996c143ad995ce7d1306fafdb", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0795afb04a634f83a0aa1f5f1da2f0c4", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "49917154667b41b39fbf9be2bdf606de", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "455e154711e34e27bcf8f8ac3ebd17cb", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "261df5e96c944c339f970ecdfbf70d3b", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_merged-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a3bc2ec62bfa4b8b8f4a4d82497d9044", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d7837b9c9cfb45d896126c364aa1213a", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.5261215129920984, &#39;tp&#39;: 86, &#39;tn&#39;: 159, &#39;fp&#39;: 32, &#39;fn&#39;: 39, &#39;auroc&#39;: 0.8100314136125654, &#39;auprc&#39;: 0.7284616601212042, &#39;acc&#39;: 0.7753164556962026, &#39;eval_loss&#39;: 0.5155150691668192}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/configs/esg_topic_invalid_merged(15)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 0
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_merged-classification/best_model
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a3cce149777c4102a33cea9877601d10", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 0.30730882 -0.42756858]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/esg_topic_invalid_merged(15)_preds.parquet
INFO:ekorpkit.datasets.config:Train data: (631, 11)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5d76a27b36eb48eab7b3299ecc759f8d", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b5b9a6cd64b945e8940cb746faa539d1", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "fc4fea56130f4c5aa9f6532090d29c4a", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "58f85512a01e44b49e62c1b456d5aaa4", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f2ae25ef1e774d1daffeb613ec873c45", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "002e2114e85b4f6d8312e2c79d9cbc75", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f63af152c2d7488b9cf243f7445bed94", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f2fc1cd2090d406f8abfd5027977e1dd", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4c50a72b3bef476693cdabba8b4877d8", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "090a54784b9040509e94e79263666691", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "26a1d7806ce249ad946190d46e312482", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9759842b03704b3b801a77be5c15d519", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_merged-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "24731c67c4c94fdfbf5d2f1f9ac52a03", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4a9472e01e6c4062a78d8f712e29583e", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.45064146873687305, &#39;tp&#39;: 151, &#39;tn&#39;: 80, &#39;fp&#39;: 59, &#39;fn&#39;: 26, &#39;auroc&#39;: 0.7718164451489655, &#39;auprc&#39;: 0.8065880177626839, &#39;acc&#39;: 0.7310126582278481, &#39;eval_loss&#39;: 0.6036376555760702}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/configs/esg_topic_invalid_merged(16)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 1
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d7dc2413eb294f3aa66eac2f59d37f48", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 0.4058331  -0.54761481]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/esg_topic_invalid_merged(16)_preds.parquet
INFO:ekorpkit.datasets.config:Train data: (632, 11)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "672ba876c94d4e1a9533cb4c929c1845", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "30be1a0c6df249edb18b0989f6717897", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9826d7538c294d2a9b6834144d75c0d7", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d22b258c0d9e42419d16629679707f7e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "33fd6a06db5943a687afdd6572f1eb69", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "be005c649ee44d7eb12702ed587fb76e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5893c49be11d423fa32d302ecd490f4f", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "41723a995ed540b5aeba6681f3762836", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6331996f881b4c9989034c37516e3d64", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "180ee1e629b14845b1039778081aa784", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "530449de79d74f88a4323181bfa7f261", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1cc8383293984dc08e26203bc9b27978", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_merged-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "581cae13f0744e6da47d21f9b43969fe", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d2845f688e8042bdbb70b84d33cafa62", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.5419871264455952, &#39;tp&#39;: 169, &#39;tn&#39;: 79, &#39;fp&#39;: 42, &#39;fn&#39;: 25, &#39;auroc&#39;: 0.8571824145863509, &#39;auprc&#39;: 0.8965878070149698, &#39;acc&#39;: 0.7873015873015873, &#39;eval_loss&#39;: 0.46483340859413147}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/configs/esg_topic_invalid_merged(17)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 2
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f2b5abd68fbf410097833d73534253e5", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 0.02637419 -0.22079509]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/esg_topic_invalid_merged(17)_preds.parquet
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_merged/esg_topic_invalid_merged(17)_cv.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 6min (started: 2022-12-17 00:48:30 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_labels&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_preds&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_probs&quot;</span><span class="p">]</span>
<span class="n">cv_preds_inval</span> <span class="o">=</span> <span class="n">cv_preds_inval</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2.8 ms (started: 2022-12-17 00:54:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inval_cv_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_cv_preds.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">cv_preds_inval</span><span class="p">,</span> <span class="n">inval_cv_filename</span><span class="p">,</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_invalid_kr/esg_invalid_cv_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 112 ms (started: 2022-12-17 00:54:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inval_cv_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_cv_preds.parquet&quot;</span>
<span class="n">cv_preds_inval</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">inval_cv_filename</span><span class="p">,</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 16.5 ms (started: 2022-12-17 00:54:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">records_with_label_error</span> <span class="o">=</span> <span class="n">sm_inval</span><span class="o">.</span><span class="n">find_label_errors</span><span class="p">(</span><span class="n">cv_preds_inval</span><span class="p">,</span> <span class="n">meta_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">records_with_label_error</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">records_with_label_error</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># remove rows from preds that have label errors</span>
<span class="n">data_inval_cved</span> <span class="o">=</span> <span class="n">cv_preds_inval</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records_with_label_error</span><span class="p">:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">metadata</span>
    <span class="n">data_inval_cved</span> <span class="o">=</span> <span class="n">data_inval_cved</span><span class="p">[</span><span class="n">data_inval_cved</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_inval_cved</span><span class="p">))</span>
<span class="n">inval_cved_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_data_cved.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">data_inval_cved</span><span class="p">,</span> <span class="n">inval_cved_filename</span><span class="p">,</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Created 947 records
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_invalid_kr/esg_invalid_data_cved.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>113
text=&#39; LG화학이 서울대와 손잡고 인공지능(AI)과 빅데이터를 통한 디지털 전환(DX·Digital Transformation)에 속도를 낸다  29일 LG화학은 서울대 공과대학에서 서울대와 \&#39;LG화학-서울대 DX 산학협력센터\&#39; 설립 협약식을 개최했다고 밝혔다  LG화학과 서울대는 DX 분야 산학협력을 통해 다양한 과제를 발굴해 수행하고 디지털 혁신을 선도할 인재를 양성하기 위해 협력해나간다는 계획이다  양측은 △DX 산학협력 과제 추진 △DX 핵심 인력 양성 교육 실시 △산학장학생 제도 운영 등 3개 분야에서 협력을 약속했다  DX 산학협력센터는 다음달부터 서울대 공과대학에서 운영된다  양측은 먼저 생산·품질·연구개발(R&amp;D)·마케팅 등 주요 핵심 영역에서 딥러닝, 데이터 마이닝 등 디지털 기술을 적용할 수 있는 공동 핵심과제를 발굴하고 수행할 계획이다  이를 위해 다음 달까지 후보 과제를 발굴·선정해 약 1년에 걸쳐 수행하고 후속 과제도 발굴할 예정이다  LG화학 임직원들을 대상으로 DX 핵심 인력 양성 교육을 진행하고 서울대 석·박사 산학장학생 제도를 운영하는 등 디지털 분야 미래 인재 육성과 산업 경쟁력 강화에도 노력할 방침이다  김성민 LG화학 CHO는 &quot;AI, 빅데이터 등 4차 산업혁명과 디지털 전환이라는 세계적인 흐름에 발맞추기 위해 핵심 기술 및 관련 제품을 스스로 개발할 수 있는 인재를 육성하는 등 DX 역량을 강화하겠다&quot;고 말했다  LG화학은 올해 DX 전담조직을 신설하고 IT 시스템의 90% 이상 클라우드 전환, 업무 지원 로봇 및 소프트웨어 표준 도입 등을 수행하는 등 디지털 전환에 집중하고 있다  [최근도 기자] &#39; inputs={&#39;text&#39;: &#39; LG화학이 서울대와 손잡고 인공지능(AI)과 빅데이터를 통한 디지털 전환(DX·Digital Transformation)에 속도를 낸다  29일 LG화학은 서울대 공과대학에서 서울대와 \&#39;LG화학-서울대 DX 산학협력센터\&#39; 설립 협약식을 개최했다고 밝혔다  LG화학과 서울대는 DX 분야 산학협력을 통해 다양한 과제를 발굴해 수행하고 디지털 혁신을 선도할 인재를 양성하기 위해 협력해나간다는 계획이다  양측은 △DX 산학협력 과제 추진 △DX 핵심 인력 양성 교육 실시 △산학장학생 제도 운영 등 3개 분야에서 협력을 약속했다  DX 산학협력센터는 다음달부터 서울대 공과대학에서 운영된다  양측은 먼저 생산·품질·연구개발(R&amp;D)·마케팅 등 주요 핵심 영역에서 딥러닝, 데이터 마이닝 등 디지털 기술을 적용할 수 있는 공동 핵심과제를 발굴하고 수행할 계획이다  이를 위해 다음 달까지 후보 과제를 발굴·선정해 약 1년에 걸쳐 수행하고 후속 과제도 발굴할 예정이다  LG화학 임직원들을 대상으로 DX 핵심 인력 양성 교육을 진행하고 서울대 석·박사 산학장학생 제도를 운영하는 등 디지털 분야 미래 인재 육성과 산업 경쟁력 강화에도 노력할 방침이다  김성민 LG화학 CHO는 &quot;AI, 빅데이터 등 4차 산업혁명과 디지털 전환이라는 세계적인 흐름에 발맞추기 위해 핵심 기술 및 관련 제품을 스스로 개발할 수 있는 인재를 육성하는 등 DX 역량을 강화하겠다&quot;고 말했다  LG화학은 올해 DX 전담조직을 신설하고 IT 시스템의 90% 이상 클라우드 전환, 업무 지원 로봇 및 소프트웨어 표준 도입 등을 수행하는 등 디지털 전환에 집중하고 있다  [최근도 기자] &#39;} prediction=[(&#39;Discarded&#39;, 0.264664666981019), (&#39;Validated&#39;, 0.735335333018981)] prediction_agent=None annotation=&#39;Discarded&#39; annotation_agent=None multi_label=False explanation=None id=None metadata={&#39;index&#39;: 694, &#39;label_error_candidate&#39;: 0} status=&#39;Validated&#39; event_timestamp=None metrics=None search_keywords=None
834
time: 502 ms (started: 2022-12-17 00:54:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">inval_cved_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_invalid_data_cved.parquet&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_invalid_cved&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">ds_inval</span><span class="o">.</span><span class="n">data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">inval_cved_filename</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="c1"># cfg.dataset.dev_size = 0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">3247616750</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s2">&quot;entelecheia/ekonelectra-base-discriminator&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">48</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">48</span>

<span class="n">sm_inval</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 3.47 s (started: 2022-12-17 00:54:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm_inval</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="n">sm_inval</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.3
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 3247616750
INFO:ekorpkit.datasets.config:Train data: (583, 6)
INFO:ekorpkit.datasets.config:Test data: (251, 6)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_512_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7835a981696f4e17be3e450d3b98e680", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "75c424bf0f9f478097adc2a511870dc5", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4608bf94527145fd836854cdc81bd9a3", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "966ccd8bf99046a8abb6313f1d273028", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "bc021d6d23f246a4b898f1faf920c9e9", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b105ab79e8244571896a77ff5e66bcc6", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "034829a3fec2403fa8c3ceff58eefa05", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9a024459c5bd4e569000144ac4908f32", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c8a1452b22624b69ad5868a3e0e7e0c7", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9e1901fbc262412ca5d4fd40297e989d", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "3d9c529f5fea41e9abb5d96f299c8e2f", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "fbf1743e0736446da69a0914e9000e89", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_cved-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_512_2_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f175d226821c414da20945e16f05566b", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7914cecd5cdb4434ae4738c137b15162", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.5644373413818418, &#39;tp&#39;: 55, &#39;tn&#39;: 149, &#39;fp&#39;: 24, &#39;fn&#39;: 23, &#39;auroc&#39;: 0.892322513709797, &#39;auprc&#39;: 0.7437838409291504, &#39;acc&#39;: 0.8127490039840638, &#39;eval_loss&#39;: 0.6239469746748606}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_cved/configs/esg_topic_invalid_cved(1)_config.yaml
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_cved-classification
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4005d5f522e54c569d16ec87223f2809", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 2.2862947  -2.30610156]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_cved/esg_topic_invalid_cved(1)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy:  0.8127490039840638
Precison:  0.8134265997534735
Recall:  0.8127490039840638
F1 Score:  0.8130739664806114
Model Report: 
___________________________________________________
              precision    recall  f1-score   support

   Discarded       0.70      0.71      0.70        78
   Validated       0.87      0.86      0.86       173

    accuracy                           0.81       251
   macro avg       0.78      0.78      0.78       251
weighted avg       0.81      0.81      0.81       251
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.visualize.base:Saved figure to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_cved/esg_topic_invalid_cved(1)_confusion_matrix.png
</pre></div>
</div>
<img alt="../../../_images/all_in_one_pipeline_26_23.png" src="../../../_images/all_in_one_pipeline_26_23.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2min 59s (started: 2022-12-17 00:54:35 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="section" id="filter-out-invalid-topics">
<h3>Filter out invalid topics<a class="headerlink" href="#filter-out-invalid-topics" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;dataset=dataset&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topics_improved&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;/workspace/data/datasets/simple&quot;</span>
<span class="n">ds_tp</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_tp</span><span class="o">.</span><span class="n">splits</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">ds_tp</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.info.column:index: index, index of data: index, columns: [&#39;id&#39;, &#39;text&#39;, &#39;labels&#39;, &#39;class&#39;, &#39;example_id&#39;, &#39;count&#39;, &#39;split&#39;], id: [&#39;id&#39;]
INFO:ekorpkit.info.column:Adding id [split] to [&#39;id&#39;]
INFO:ekorpkit.info.column:Added id [split], now [&#39;id&#39;, &#39;split&#39;]
INFO:ekorpkit.info.column:Added a column [split] with value [train]
INFO:ekorpkit.info.column:Added a column [split] with value [dev]
INFO:ekorpkit.info.column:Added a column [split] with value [test]
INFO:ekorpkit.io.file:Concatenating 3 dataframes
INFO:ekorpkit.io.file:Concatenating 3 dataframes
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;S-기업(공급망)동반성장/상생&#39;, &#39;G-지배구조&#39;, &#39;G-기업윤리/불공정/소송&#39;, &#39;S-소비자&#39;, &#39;E-환경혁신&#39;, &#39;S-사회공헌&#39;, &#39;S-고용&#39;, &#39;E-환경영향&#39;, &#39;E-기후변화&#39;, &#39;S-재해/안전관리&#39;] 10 11054
time: 1.43 s (started: 2022-12-17 00:57:34 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_tp_predicted</span> <span class="o">=</span> <span class="n">sm_inval</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ds_tp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 3 dataframes
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d8d28121703d4a5bb9d4c91a3d3d7ec1", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 2.32957101 -2.3210566 ]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_cved/esg_topic_invalid_cved(1)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 1min 21s (started: 2022-12-17 00:57:36 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select only validated data with pred_probs &gt; 0.6</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_tp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ds_tp_valid</span> <span class="o">=</span> <span class="n">ds_tp_predicted</span><span class="p">[(</span><span class="n">ds_tp_predicted</span><span class="o">.</span><span class="n">pred_labels</span> <span class="o">==</span> <span class="s2">&quot;Validated&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_tp_predicted</span><span class="o">.</span><span class="n">pred_probs</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_tp_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_tp_valid</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 3 dataframes
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11054, 7)
(9108, 10)
S-소비자               2299
G-지배구조              1453
S-고용                1420
G-기업윤리/불공정/소송        854
E-환경혁신               716
S-사회공헌               642
E-환경영향               525
E-기후변화               521
S-재해/안전관리            348
S-기업(공급망)동반성장/상생     330
Name: labels, dtype: int64
time: 10.1 ms (started: 2022-12-17 00:58:57 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/outputs/esg_topic_labels/esg_topic_labels(0)_export.parquet&quot;</span>
<span class="n">tp_add</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="c1"># exclude UNKNOWN and ESG</span>
<span class="n">tp_add</span> <span class="o">=</span> <span class="n">tp_add</span><span class="p">[</span><span class="o">~</span><span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;ESG&quot;</span><span class="p">])]</span>
<span class="c1"># combine tp_add and ds_tp_valid with [&#39;text&#39;, &#39;labels&#39;] columns only</span>
<span class="n">ds_tp_merged</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">concat_data</span><span class="p">([</span><span class="n">ds_tp_valid</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]],</span> <span class="n">tp_add</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_tp_merged</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_tp_merged</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Save data</span>
<span class="n">valid_topic_file</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_labels_validated.parquet&quot;</span>
<span class="n">valid_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/esg_topic_validated&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">ds_tp_merged</span><span class="p">,</span> <span class="n">valid_topic_file</span><span class="p">,</span> <span class="n">valid_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_topic_validated/esg_topic_labels_validated.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9448, 2)
S-소비자               2313
G-지배구조              1519
S-고용                1440
G-기업윤리/불공정/소송        911
E-환경혁신               788
S-사회공헌               653
E-기후변화               574
E-환경영향               530
S-기업(공급망)동반성장/상생     363
S-재해/안전관리            357
Name: labels, dtype: int64
time: 664 ms (started: 2022-12-17 00:58:57 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="training-further-on-the-additional-topic-data">
<h2>Training further on the additional topic data<a class="headerlink" href="#training-further-on-the-additional-topic-data" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">valid_topic_file</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_labels_validated.parquet&quot;</span>
<span class="n">valid_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/esg_topic_validated&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topics_validated&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">valid_data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">valid_topic_file</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">977634889</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s2">&quot;entelecheia/ekonelectra-base-discriminator&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">smt</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 3.45 s (started: 2022-12-17 00:58:57 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_preds_topic</span> <span class="o">=</span> <span class="n">smt</span><span class="o">.</span><span class="n">cross_val_predict</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dev_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.3
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 977634889
INFO:ekorpkit.datasets.config:Train data: (6613, 2)
INFO:ekorpkit.datasets.config:Test data: (2835, 2)
INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.datasets.config:Train data: (7086, 2)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ac283134eaf147458b704e04ee0e58fc", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c2505402893745bfbe1d9e6825dbff05", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "80ef123799df41b78dee6863ccd09db1", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "32c943e18d754ebb812cc0b6ea57b8da", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "60608d1747534a818c3e54d5eb31fdeb", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "00b2aa26b0f1413baf610af2a161a01d", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "84f483d7bceb44d68c68239ba562222e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1bdf4928bcfe466ab6c08a8dcc5f903d", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "256c10e112d04dc4aa1c519ca827794c", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b86f3080bc3e41ee8e7806f436ea7658", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "caf6cfe7ad914e3c886ef7ed050a4f88", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1d97caf3fe604bb2bebf4f6215959b27", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_validated-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "fb3d68c2a2d64dbdb14275185d8f8a61", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "395fb655991a4ed3ba83f3f1a5005b72", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7605312922484171, &#39;acc&#39;: 0.7938187976291279, &#39;eval_loss&#39;: 0.8000878221110294}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/configs/esg_topics_validated(12)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 0
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_validated-classification
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "350000163d2c4328b1be572b5957ebbf", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 5.9853487  -1.57939267 -1.13330126 -1.34939277 -0.3317107   0.01635014
 -0.13009873 -0.1246738  -1.16066349 -1.43532479]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/esg_topics_validated(12)_preds.parquet
INFO:ekorpkit.datasets.config:Train data: (7086, 5)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "e1a78c913b50457c9ac69fd2f7c5ff78", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c1700f22a2484d9dbfbb6d771af48912", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2d45b40cf6c844fa911d57ecc1fec7c3", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "28ed1405496d4ee0991d4148eeca0f32", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "970389bda51547c391f145bd0ba88678", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "62c890d96a194c60b1132e24bcb4285b", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "abf649531b0e45f986cbcf38d6754f20", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "bebf3bbed57f473886baa5210dc72682", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6c165cc9d7f84e3d8894a1741a5924a7", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "65809cfba480488491b0276850c79a9d", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ab152a74c3c443afb96af31566e7ceaf", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6a5275b2336844fda371ad6ec94a5c7c", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_validated-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "36e01df2c5db490a9120e8ccf1c4afbe", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "634b3ab3cfd74094bdc5da6afea070ae", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7719688515253981, &#39;acc&#39;: 0.8039796782387807, &#39;eval_loss&#39;: 0.788326875159615}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/configs/esg_topics_validated(13)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 1
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2381d1ed3f2f43f090295136d8745fe0", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 6.01948023 -1.58157551 -1.27724278 -1.53617513 -0.22583501 -0.175418
 -0.07375064 -0.01960763 -1.1382457  -1.31032717]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/esg_topics_validated(13)_preds.parquet
INFO:ekorpkit.datasets.config:Train data: (7086, 5)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b98ad6b9b56348e786fd178ab6da8eea", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4eff96cde5ef4140a84839d2f2375bd9", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8602f04a16594618a47bb65a5151d1c4", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a81978c72fe2491488a5bfa3e74098cf", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c1ac1f29dbc241b2816df3a33f99e710", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2a438e6e8c754e4b936283db5ef77c1c", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "89cfb6e0a9044401afd14ece4db93cc4", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c4f6eddc86434baeaa98ea8540aed8d0", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "030d4ddf18d84e38beafdfea57f1db29", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7d4e3086035b4bbf8acb0241860cdb96", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d21f4759b34d4f268e7d400e52793d15", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f46971c070834c01ad766b4af4147142", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_validated-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0edd21a9cbfb42a6958ef17ac6cd44ee", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "81735f47e68d477ab0faa7f6e2367345", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7611969832189905, &#39;acc&#39;: 0.7955122777307366, &#39;eval_loss&#39;: 0.791275397727364}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/configs/esg_topics_validated(14)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 2
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "06c3f0d2653549a58aabc407172defe3", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [-0.44262895 -1.98779929  5.92393446  0.49648684 -1.43522871 -1.86107802
 -0.57101792 -0.96842241 -0.23700489 -0.78135854]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/esg_topics_validated(14)_preds.parquet
INFO:ekorpkit.datasets.config:Train data: (7086, 5)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:No columns or data to rename
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "e7f7a4c24201477cb5a18f2c29361d39", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1cc074a26e984001ba8bd0b72feef445", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "3a1e92af786141b891cc1dbedbced877", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4d0218f9a67f43bcacf1acdbadd9f431", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5c206c2abab342698edb191e827702b7", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "148afd17d42a42efb5930cc3ce2c377e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4427dd64fca44f519d239c7468147427", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "99acd70439e248a591e4f966f862a74a", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7de798f627bf404381d9e50f835860c5", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "7956b957681a4aeca789a6ba73278314", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "94a5457a929b41f8800de77e2d95a14e", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "99ece1d8162442e78e506c04ce79d8e3", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_validated-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a9455f2ec13b43eba5aa1d2422260a10", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9ecc9fde30b24b118260391887d91e69", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.756168943381817, &#39;acc&#39;: 0.790008467400508, &#39;eval_loss&#39;: 0.8251208694357621}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/configs/esg_topics_validated(15)_config.yaml
INFO:ekorpkit.models.transformer.simple:Predicting split 3
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2893a8ebbc8d4893a996bfac79e4fcdf", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 6.02145815 -1.79686356 -1.11947501 -1.68748939 -0.29376069 -0.35863328
 -0.17506261  0.07965102 -0.94695491 -1.12279844]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/esg_topics_validated(15)_preds.parquet
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_validated/esg_topics_validated(15)_cv.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 48min 31s (started: 2022-12-17 00:59:01 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_labels&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_preds&quot;</span><span class="p">,</span> <span class="s2">&quot;pred_probs&quot;</span><span class="p">]</span>
<span class="n">cv_preds_topic</span> <span class="o">=</span> <span class="n">cv_preds_topic</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 3.68 ms (started: 2022-12-17 01:47:32 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">records_with_label_error</span> <span class="o">=</span> <span class="n">smt</span><span class="o">.</span><span class="n">find_label_errors</span><span class="p">(</span><span class="n">cv_preds_topic</span><span class="p">,</span> <span class="n">meta_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">records_with_label_error</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">records_with_label_error</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># remove rows from preds that have label errors</span>
<span class="n">data_topic_cved</span> <span class="o">=</span> <span class="n">cv_preds_topic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records_with_label_error</span><span class="p">:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">metadata</span>
    <span class="n">data_topic_cved</span> <span class="o">=</span> <span class="n">data_topic_cved</span><span class="p">[</span><span class="n">data_topic_cved</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_topic_cved</span><span class="p">))</span>
<span class="n">topic_cved_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_data_cved.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">data_topic_cved</span><span class="p">,</span> <span class="n">topic_cved_filename</span><span class="p">,</span> <span class="n">valid_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Created 9448 records
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>388
text=&quot;싱가포르 항공 은 이번 평가 에서 좌석 공간 과 편안함 고객서비스 가격 대비 만족 도 청결 도 체크인 · 탑승 기내식 기내 엔터테인먼트 ( 무선 인터넷 · tv · 영화 ) 등 항목 에서 고르게 최고점 을 받았다 .\n특히 이코노미 클래스 와 퍼스트 클래스 에서 최우수 평가 를 받았다 .\n고춘 퐁 ( goh choon phong ) 싱가포르 항공 ceo 는 &#39; 이번 수상 은 싱가포르 항공 을 통해 고객 들 이 느낀 높은 만족감 을 보여준다는 점 에서 더욱 뜻 깊고 영광 스러운 일 &#39; 이라고 말 했다 .\n이어 &#39; 우수 한 고객 서비스 와 지속적 인 기내 프로덕트 혁신 을 통해 얻은 결과 인 만큼 앞 으로도 고객 의 기대 를 뛰어넘는 최고 의 비행 경험 을 선사 하기 위해 끊임없이 노력 할 것 &#39; 이라고 덧붙였다 .&quot; inputs={&#39;text&#39;: &quot;싱가포르 항공 은 이번 평가 에서 좌석 공간 과 편안함 고객서비스 가격 대비 만족 도 청결 도 체크인 · 탑승 기내식 기내 엔터테인먼트 ( 무선 인터넷 · tv · 영화 ) 등 항목 에서 고르게 최고점 을 받았다 .\n특히 이코노미 클래스 와 퍼스트 클래스 에서 최우수 평가 를 받았다 .\n고춘 퐁 ( goh choon phong ) 싱가포르 항공 ceo 는 &#39; 이번 수상 은 싱가포르 항공 을 통해 고객 들 이 느낀 높은 만족감 을 보여준다는 점 에서 더욱 뜻 깊고 영광 스러운 일 &#39; 이라고 말 했다 .\n이어 &#39; 우수 한 고객 서비스 와 지속적 인 기내 프로덕트 혁신 을 통해 얻은 결과 인 만큼 앞 으로도 고객 의 기대 를 뛰어넘는 최고 의 비행 경험 을 선사 하기 위해 끊임없이 노력 할 것 &#39; 이라고 덧붙였다 .&quot;} prediction=[(&#39;S-소비자&#39;, 0.9897604143328605), (&#39;E-기후변화&#39;, 0.00033954614695828753), (&#39;S-고용&#39;, 0.0010764540560271147), (&#39;G-지배구조&#39;, 0.0006275287427944966), (&#39;E-환경영향&#39;, 0.001158181043895845), (&#39;E-환경혁신&#39;, 0.0013669920144253325), (&#39;G-기업윤리/불공정/소송&#39;, 0.0017702516756714884), (&#39;S-기업(공급망)동반성장/상생&#39;, 0.0023943532474521405), (&#39;S-사회공헌&#39;, 0.0009222622135478406), (&#39;S-재해/안전관리&#39;, 0.0005840165263666533)] prediction_agent=None annotation=&#39;G-지배구조&#39; annotation_agent=None multi_label=False explanation=None id=None metadata={&#39;index&#39;: 1922, &#39;label_error_candidate&#39;: 0} status=&#39;Validated&#39; event_timestamp=None metrics=None search_keywords=None
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_topic_validated/esg_topic_data_cved.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9060
time: 4.95 s (started: 2022-12-17 01:47:32 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/outputs/esg_topic_labels/esg_topic_labels(0)_export.parquet&quot;</span>
<span class="n">tp_add</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="c1"># exclude UNKNOWN and ESG</span>
<span class="n">tp_add</span> <span class="o">=</span> <span class="n">tp_add</span><span class="p">[</span><span class="o">~</span><span class="n">tp_add</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;ESG&quot;</span><span class="p">])]</span>
<span class="c1"># combine tp_add and ds_tp_valid with [&#39;text&#39;, &#39;labels&#39;] columns only</span>
<span class="n">topic_cv_merged</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">concat_data</span><span class="p">([</span><span class="n">data_topic_cved</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]],</span> <span class="n">tp_add</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">topic_cv_merged</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">topic_cv_merged</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Save data</span>
<span class="n">topic_cved_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_data_cved_mreged.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">topic_cv_merged</span><span class="p">,</span> <span class="n">topic_cved_filename</span><span class="p">,</span> <span class="n">valid_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Concatenating 2 dataframes
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/esg_topic_validated/esg_topic_data_cved_mreged.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9400, 2)
S-소비자               2265
G-지배구조              1545
S-고용                1436
G-기업윤리/불공정/소송        903
E-환경혁신               802
S-사회공헌               649
E-기후변화               591
E-환경영향               489
S-기업(공급망)동반성장/상생     362
S-재해/안전관리            358
Name: labels, dtype: int64
time: 692 ms (started: 2022-12-17 01:47:37 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">topic_cved_filename</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_data_cved_mreged.parquet&quot;</span>
<span class="n">valid_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/esg_topic_validated&quot;</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s1">&#39;task=simple.classification&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topics_cved&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">valid_data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data_files</span> <span class="o">=</span> <span class="n">topic_cved_filename</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">dev_size</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">977634889</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s2">&quot;entelecheia/ekonelectra-base-discriminator&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">num_train_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">train_batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">eval_batch_size</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">smt</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 3.49 s (started: 2022-12-17 01:47:38 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smt</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.datasets.config:Splitting the dataframe into train and test with ratio 0.2
INFO:ekorpkit.datasets.config:Splitting the dataframe into train and dev with ratio 0.2
INFO:ekorpkit.datasets.config:Shuffling the dataframe with seed 977634889
INFO:ekorpkit.datasets.config:Train data: (6016, 2)
INFO:ekorpkit.datasets.config:Test data: (1880, 2)
INFO:ekorpkit.datasets.config:Dev data: (1504, 2)
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
INFO:ekorpkit.models.transformer.simple:Renaming columns: {}
Some weights of the model checkpoint at entelecheia/ekonelectra-base-discriminator were not used when initializing ElectraForSequenceClassification: [&#39;discriminator_predictions.dense_prediction.weight&#39;, &#39;discriminator_predictions.dense.weight&#39;, &#39;discriminator_predictions.dense.bias&#39;, &#39;discriminator_predictions.dense_prediction.bias&#39;]
- This IS expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ElectraForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ElectraForSequenceClassification were not initialized from the model checkpoint at entelecheia/ekonelectra-base-discriminator and are newly initialized: [&#39;classifier.out_proj.bias&#39;, &#39;classifier.dense.weight&#39;, &#39;classifier.out_proj.weight&#39;, &#39;classifier.dense.bias&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_train_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "aabd4a6c30a649618a65c84d96d4d130", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for training.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "fc56d1016af54b89863be55c51a0ced6", "version_major": 2, "version_minor": 0}
</script><script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0620937effc6499d9609f663c6707d73", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.4053047266418383, &#39;acc&#39;: 0.49601063829787234, &#39;eval_loss&#39;: 1.7612815499305725}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "05e8f889745a44c198df0b9f4c30fee6", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7182882569855017, &#39;acc&#39;: 0.757313829787234, &#39;eval_loss&#39;: 0.9193831036488215}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "611f131af12444b9908c7af18858b62c", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7748971935126667, &#39;acc&#39;: 0.8065159574468085, &#39;eval_loss&#39;: 0.7227616955836614}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "cb0c2c9d0a4244518ec0b885dde2aa63", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7864067428867297, &#39;acc&#39;: 0.8164893617021277, &#39;eval_loss&#39;: 0.6524468412001928}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1205a66765934f6f916b86e122bce164", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7842642795170566, &#39;acc&#39;: 0.8138297872340425, &#39;eval_loss&#39;: 0.6461221526066462}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "00795fcd6fec40948ab56b015762bbf4", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7914698596081943, &#39;acc&#39;: 0.8204787234042553, &#39;eval_loss&#39;: 0.6538690974315008}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8d981b1c4a624b479dc26ca53e9ea0b1", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7985231311837293, &#39;acc&#39;: 0.8264627659574468, &#39;eval_loss&#39;: 0.6644373387098312}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b322b465a3344d9189406ea02bc47828", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7993943198120286, &#39;acc&#39;: 0.8271276595744681, &#39;eval_loss&#39;: 0.6578289543588957}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5eb861ab6907459abc1e97d2e1f27ad5", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8018733551633995, &#39;acc&#39;: 0.8297872340425532, &#39;eval_loss&#39;: 0.6825426071882248}
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a85043de55f842bba83507941462ea65", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.7989868884916935, &#39;acc&#39;: 0.8271276595744681, &#39;eval_loss&#39;: 0.6802134936054548}
INFO:simpletransformers.classification.classification_model: Training of electra model complete. Saved to /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_cved-classification.
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
INFO:simpletransformers.classification.classification_utils: Saving features into cached file /workspace/.cache/cached_dev_electra_256_10_2
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8e4ec2310ccc4bc89f47f31ca86785a2", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model: Initializing WandB run for evaluation.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a32b5002acd145ff9c67c2f2bd21f48f", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_model:{&#39;mcc&#39;: 0.8065837863234686, &#39;acc&#39;: 0.8335106382978723, &#39;eval_loss&#39;: 0.6546976029872894}
INFO:ekorpkit.config:Saving config to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_cved/configs/esg_topics_cved(3)_config.yaml
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 11min 16s (started: 2022-12-17 01:47:41 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smt</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">include_values</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">smt</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="o">.</span><span class="n">include_percentages</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">smt</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">smt</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_cved-classification/best_model
INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "087be2d168a7485489f4f9e6ddcbad82", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 0.64087743 -0.97763002 -0.67245495 -1.31193423 -1.34377241  0.05310853
 -0.33475915  3.93648148 -0.79432243  0.83153814]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_cved/esg_topics_cved(3)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy:  0.824468085106383
Precison:  0.8307886859209715
Recall:  0.824468085106383
F1 Score:  0.8238006616461439
Model Report: 
___________________________________________________
                  precision    recall  f1-score   support

          E-기후변화       0.91      0.64      0.75       129
          E-환경영향       0.75      0.70      0.72       105
          E-환경혁신       0.64      0.88      0.74       169
   G-기업윤리/불공정/소송       0.76      0.65      0.70       151
          G-지배구조       0.88      0.90      0.89       295
            S-고용       0.87      0.89      0.88       278
S-기업(공급망)동반성장/상생       0.77      0.68      0.72        73
          S-사회공헌       0.86      0.86      0.86       140
           S-소비자       0.87      0.86      0.87       465
       S-재해/안전관리       0.81      0.84      0.82        75

        accuracy                           0.82      1880
       macro avg       0.81      0.79      0.80      1880
    weighted avg       0.83      0.82      0.82      1880
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.visualize.base:Saved figure to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_cved/esg_topics_cved(3)_confusion_matrix.png
</pre></div>
</div>
<img alt="../../../_images/all_in_one_pipeline_40_5.png" src="../../../_images/all_in_one_pipeline_40_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 9.86 s (started: 2022-12-17 01:58:58 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-data-to-predict">
<h2>Load data to predict<a class="headerlink" href="#load-data-to-predict" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">news_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/econ_news_kr/news_slice&quot;</span>

<span class="n">chunk_data</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
    <span class="s2">&quot;econ_news_kr_chunks_*_20220911.parquet&quot;</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">,</span> <span class="n">concatenate</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chunk_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">chunk_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1833910, 3)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>chunk_id</th>
      <th>filename</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>△ 사진 설명 : 경자년 새해가 밝았다  제각각 삶터에서 묵묵히 노력하는 대한민국...</td>
      <td>0</td>
      <td>02100101.20200101001103001.txt</td>
    </tr>
    <tr>
      <th>1</th>
      <td>"청년 벤처기업가들한테 진짜로 미안했어요  부끄럽고 " 지난해 12월 29일 서울...</td>
      <td>0</td>
      <td>02100101.20200101001253001.txt</td>
    </tr>
    <tr>
      <th>2</th>
      <td>오늘부터 30년 후면 2050년이다  30년 전인 1990년을 전후하여 세계는 독...</td>
      <td>0</td>
      <td>02100101.20200101001855001.txt</td>
    </tr>
    <tr>
      <th>3</th>
      <td>◆ 2020 경제기상도 / 환율 ◆ 지난해 미·중 무역분쟁이라는 대형 변수로 출렁...</td>
      <td>0</td>
      <td>02100101.20200101040159002.txt</td>
    </tr>
    <tr>
      <th>4</th>
      <td>◆ 2020 경제기상도 / 업종별 전망 (반도체) ◆ 지난해 미·중 무역분쟁과 공...</td>
      <td>0</td>
      <td>02100101.20200101040200001.txt</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 15.7 s (started: 2022-12-29 10:49:40 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1833910 entries, 0 to 785336
Data columns (total 3 columns):
 #   Column    Dtype 
---  ------    ----- 
 0   text      object
 1   chunk_id  int64 
 2   filename  object
dtypes: int64(1), object(2)
memory usage: 56.0+ MB
time: 3.93 ms (started: 2022-12-29 10:49:56 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-company-code-info">
<h2>Load company code info<a class="headerlink" href="#load-company-code-info" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;io/loader=plaintext_parser&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">news_data_dir</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data_sources</span> <span class="o">=</span> <span class="s2">&quot;econ_news_kr_chunks_*_20221229.txt&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="n">codes</span><span class="o">=</span><span class="s2">&quot;codes&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">split</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">data_key</span> <span class="o">=</span> <span class="s2">&quot;codes&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">progress_per</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">code_info</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">code_info</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.load.data:==&gt; processing 1/3 files &lt;==
INFO:ekorpkit.io.parse.json:Number of data in the contents: 110689
INFO:ekorpkit.io.load.data:==&gt; processing 2/3 files &lt;==
INFO:ekorpkit.io.parse.json:Number of data in the contents: 281398
INFO:ekorpkit.io.load.data:==&gt; processing 3/3 files &lt;==
INFO:ekorpkit.io.parse.json:Number of data in the contents: 251404
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;filename&#39;: &#39;econ_news_kr_chunks_2022_code_20221229.txt&#39;, &#39;codes&#39;: &#39;02100101.20220101002520005,1,005380&#39;}
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>codes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>643486</th>
      <td>econ_news_kr_chunks_2020_code_20221229.txt</td>
      <td>02100851.20201231140203001,0,001680</td>
    </tr>
    <tr>
      <th>643487</th>
      <td>econ_news_kr_chunks_2020_code_20221229.txt</td>
      <td>02100851.20201231141813001,0,001750</td>
    </tr>
    <tr>
      <th>643488</th>
      <td>econ_news_kr_chunks_2020_code_20221229.txt</td>
      <td>02100851.20201231164457001,0,000660</td>
    </tr>
    <tr>
      <th>643489</th>
      <td>econ_news_kr_chunks_2020_code_20221229.txt</td>
      <td>02100851.20201231171734001,0,006360</td>
    </tr>
    <tr>
      <th>643490</th>
      <td>econ_news_kr_chunks_2020_code_20221229.txt</td>
      <td>02100851.20201231204324001,0,068270</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 1min (started: 2022-12-29 10:50:06 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">code_info_available</span> <span class="o">=</span> <span class="n">code_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">27</span><span class="p">:]</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;num_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="n">code_info_available</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;codes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 2.63 s (started: 2022-12-29 10:51:16 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2275
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 54.1 ms (started: 2022-12-29 10:51:20 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">code_info_available</span> <span class="o">=</span> <span class="n">code_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">27</span><span class="p">:]</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;chunk_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;num_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="p">[</span><span class="s2">&quot;codes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="n">code_info_available</span> <span class="o">=</span> <span class="n">code_info_available</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;codes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">code_info_available</span><span class="p">,</span> <span class="s2">&quot;econ_news_code_info_available_20221229.parquet&quot;</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">code_info_available</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">code_info_available</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/econ_news_code_info_available_20221229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(694599, 4)
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 694599 entries, 0 to 694598
Data columns (total 4 columns):
 #   Column     Non-Null Count   Dtype 
---  ------     --------------   ----- 
 0   filename   694599 non-null  object
 1   codes      694599 non-null  object
 2   chunk_id   694599 non-null  int64 
 3   num_codes  694599 non-null  int64 
dtypes: int64(2), object(2)
memory usage: 21.2+ MB
time: 3.12 s (started: 2022-12-29 10:51:46 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filtered_data</span> <span class="o">=</span> <span class="n">chunk_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">code_info_available</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span>
<span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">]</span>
<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">,</span> <span class="s2">&quot;econ_news_filtered_202201229.parquet&quot;</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/econ_news_filtered_202201229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(718453, 4)
time: 1min 7s (started: 2022-12-29 10:52:00 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filter-out-invalid-data">
<h2>Filter out invalid data<a class="headerlink" href="#filter-out-invalid-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;task=simple.classification&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topic_invalid_cved&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-classification&quot;</span>

<span class="n">sm_inval</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">sm_inval</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">sm_inval</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-12-29 10:53:25.970902: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topic_invalid_cved-classification
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 7.21 s (started: 2022-12-29 10:53:25 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">invalid_preds_df</span> <span class="o">=</span> <span class="n">sm_inval</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d5188fc9c4444b1eb47cb0f263adc02a", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 2.32296014 -2.33493686]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topic_invalid_cved/esg_topic_invalid_cved(2)_preds.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 1h 30min 23s (started: 2022-12-29 10:53:38 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">]</span>
<span class="n">valid_data</span> <span class="o">=</span> <span class="n">invalid_preds_df</span><span class="p">[</span><span class="n">invalid_preds_df</span><span class="o">.</span><span class="n">pred_labels</span> <span class="o">==</span> <span class="s2">&quot;Validated&quot;</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">valid_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_valid_20221229.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">valid_data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/esg_news_valid_20221229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(558923, 4)
time: 1min 3s (started: 2022-12-29 12:24:02 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">news_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/econ_news_kr/news_slice&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_valid_20221229.parquet&quot;</span>

<span class="n">valid_data</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">]</span>
<span class="n">valid_data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>filename</th>
      <th>chunk_id</th>
      <th>codes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>◆ 2020 경제기상도 / 업종별 전망 (반도체) ◆ 지난해 미·중 무역분쟁과 공...</td>
      <td>02100101.20200101040200001.txt</td>
      <td>0</td>
      <td>000660</td>
    </tr>
    <tr>
      <th>2</th>
      <td>◆ 2020 경제기상도 / 업종별 전망 (가전) ◆ TV, 냉장고, 세탁기 등 전...</td>
      <td>02100101.20200101040200002.txt</td>
      <td>0</td>
      <td>066570</td>
    </tr>
    <tr>
      <th>3</th>
      <td>◆ 2020 경제기상도 / 업종별 전망 (가전) ◆ TV, 냉장고, 세탁기 등 전...</td>
      <td>02100101.20200101040200002.txt</td>
      <td>0</td>
      <td>005930</td>
    </tr>
    <tr>
      <th>4</th>
      <td>◆ 2020 경제기상도 / 업종별 전망 (디스플레이) ◆ 액정표시장치(LCD) 시...</td>
      <td>02100101.20200101040201001.txt</td>
      <td>0</td>
      <td>034220</td>
    </tr>
    <tr>
      <th>5</th>
      <td>디스플레이 업계 등에서는 삼성과 LG가 글로벌 디스플레이 시장에서 중국 업체의 L...</td>
      <td>02100101.20200101040201001.txt</td>
      <td>1</td>
      <td>003550</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 7 s (started: 2022-12-29 12:25:05 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="predict-polarities">
<h2>Predict polarities<a class="headerlink" href="#predict-polarities" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;task=simple.classification&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_polarity_validated&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-classification&quot;</span>

<span class="n">sm_pol</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">sm_pol</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">sm_pol</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_polarity_validated-classification
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 4.78 s (started: 2022-12-29 12:25:12 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">polarity_preds</span> <span class="o">=</span> <span class="n">sm_pol</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_data</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_polarity_20221229.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">polarity_preds</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "59c9b2e87a3848faa3caffe756ca5c66", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [ 5.97624731 -3.2472682  -2.35304332]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_polarity_validated/esg_polarity_validated(5)_preds.parquet
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/esg_news_polarity_20221229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 36min 51s (started: 2022-12-29 12:25:17 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="predicting-categories">
<h2>Predicting categories<a class="headerlink" href="#predicting-categories" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ekorpkit.models.transformer.simple</span> <span class="kn">import</span> <span class="n">SimpleClassification</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="s2">&quot;task=simple.classification&quot;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esg_topics_cved&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-classification&quot;</span>

<span class="n">sm_topic</span> <span class="o">=</span> <span class="n">SimpleClassification</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">sm_topic</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">sm_topic</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:Loaded model from /workspace/projects/ekorpkit-book/exmaples/esg/models/esg_topics_cved-classification
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 5.5 s (started: 2022-12-29 13:02:08 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">topic_preds</span> <span class="o">=</span> <span class="n">sm_topic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_data</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_topic_20221229.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">topic_preds</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:simpletransformers.classification.classification_utils: Converting to features started. Cache is not used.
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2e8a4ef0c32d48e995ce480c58929603", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.models.transformer.simple:type of raw_outputs: &lt;class &#39;numpy.ndarray&#39;&gt;
INFO:ekorpkit.models.transformer.simple:raw_output: [-0.37897453 -1.43046212 -0.97797042 -1.45200169 -1.20244873  0.19323829
 -0.10120457  4.33574057 -1.0516876   1.75735104]
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/outputs/esg_topics_cved/esg_topics_cved(4)_preds.parquet
INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/esg_news_topic_20221229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 36min 47s (started: 2022-12-29 13:02:14 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_topic_20221229.parquet&quot;</span>
<span class="n">topic_preds</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_polarity_20221229.parquet&quot;</span>
<span class="n">polarity_preds</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>

<span class="n">polarity_data</span> <span class="o">=</span> <span class="n">polarity_preds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pred_labels&quot;</span><span class="p">:</span> <span class="s2">&quot;polairty_preds&quot;</span><span class="p">})[</span>
    <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">,</span> <span class="s2">&quot;polairty_preds&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">esg_prediction_data</span> <span class="o">=</span> <span class="n">polarity_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">topic_preds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pred_labels&quot;</span><span class="p">:</span> <span class="s2">&quot;topic_preds&quot;</span><span class="p">})[</span>
        <span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_preds&quot;</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_id&quot;</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_prediction_results_20221229.parquet&quot;</span>
<span class="n">eKonf</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">esg_prediction_data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:ekorpkit.io.file:Saving dataframe to /workspace/projects/ekorpkit-book/exmaples/esg/data/econ_news_kr/news_slice/esg_news_prediction_results_20221229.parquet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 1min 22s (started: 2022-12-29 13:39:01 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">news_data_dir</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">/</span> <span class="s2">&quot;esg/data/econ_news_kr/news_slice&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;esg_news_prediction_results_20221229.parquet&quot;</span>

<span class="n">esg_prediction_data</span> <span class="o">=</span> <span class="n">eKonf</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">news_data_dir</span><span class="p">)</span>
<span class="n">esg_prediction_data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>filename</th>
      <th>chunk_id</th>
      <th>codes</th>
      <th>polairty_preds</th>
      <th>topic_preds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>668761</th>
      <td>조현준 효성그룹 회장이 내년에는 호랑이처럼 민첩한 조직으로 변화할 것을 주문했다 ...</td>
      <td>02100851.20211231104409001.txt</td>
      <td>0</td>
      <td>004800</td>
      <td>Neutral</td>
      <td>G-지배구조</td>
    </tr>
    <tr>
      <th>668762</th>
      <td>미래에셋 "직원들 요청 있어" 내부선 인력유출 우려도   [사진=미래에셋증권]  ...</td>
      <td>02100851.20211231112402001.txt</td>
      <td>0</td>
      <td>006800</td>
      <td>Negative</td>
      <td>S-고용</td>
    </tr>
    <tr>
      <th>668763</th>
      <td>중기부, '손실보상 선지급 금융 프로그램' 신설 방역지원금·방역물품지원금 등도 신...</td>
      <td>02100851.20211231112403001.txt</td>
      <td>0</td>
      <td>001680</td>
      <td>Positive</td>
      <td>S-사회공헌</td>
    </tr>
    <tr>
      <th>668764</th>
      <td>배재훈 HMM 대표가 코로나19로 인한 물류대란과 공급망 변화에 발 빠르게 대응해...</td>
      <td>02100851.20211231115157001.txt</td>
      <td>0</td>
      <td>011200</td>
      <td>Neutral</td>
      <td>E-환경혁신</td>
    </tr>
    <tr>
      <th>668765</th>
      <td>권칠승 중기부 장관[사진=중기부]  권칠승 중소벤처기업부 장관이 31일 신년사를 ...</td>
      <td>02100851.20211231143447001.txt</td>
      <td>0</td>
      <td>001680</td>
      <td>Neutral</td>
      <td>S-사회공헌</td>
    </tr>
    <tr>
      <th>668766</th>
      <td>해외 투지 공로…북미지역 내 소형 트랙터 수요 성장세 김희용 티와이엠(TYM) 회...</td>
      <td>02100851.20211231150933001.txt</td>
      <td>0</td>
      <td>002900</td>
      <td>Positive</td>
      <td>S-기업(공급망)동반성장/상생</td>
    </tr>
    <tr>
      <th>668767</th>
      <td>SKT 952만·KT 615만·LG유플러스 446만 [사진=게티이미지뱅크 제공] ...</td>
      <td>02100851.20211231181802001.txt</td>
      <td>0</td>
      <td>030200</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>668768</th>
      <td>지난 8월에 삼성전자가 출시한 갤럭시Z폴드3와 갤럭시Z플립3 흥행도 5G 가입자 ...</td>
      <td>02100851.20211231181802001.txt</td>
      <td>1</td>
      <td>005930</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>668769</th>
      <td>올해 12년래 가장 큰 상승폭을 기록할 것으로 전망되고 있는 유가가 내년에도 계속...</td>
      <td>02100851.20211231182324001.txt</td>
      <td>0</td>
      <td>267790</td>
      <td>Neutral</td>
      <td>E-기후변화</td>
    </tr>
    <tr>
      <th>668770</th>
      <td>홍은택 카카오커머스 대표[사진=카카오커머스]  홍은택 카카오커머스 대표가 새해에 ...</td>
      <td>02100851.20211231210909001.txt</td>
      <td>0</td>
      <td>035720</td>
      <td>Neutral</td>
      <td>S-고용</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 6.89 s (started: 2022-12-29 13:40:24 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">esg_prediction_data</span><span class="p">[</span><span class="n">esg_prediction_data</span><span class="o">.</span><span class="n">codes</span> <span class="o">==</span> <span class="s2">&quot;000020&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>filename</th>
      <th>chunk_id</th>
      <th>codes</th>
      <th>polairty_preds</th>
      <th>topic_preds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7384</th>
      <td>동국제약 '인사돌', 효능 논란 끝내고 정면승부로 성장세 동화약품 '잇치', 경쟁...</td>
      <td>02100851.20200108160505001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>32708</th>
      <td>[아시아경제 김민영 기자] 동화약품은 보통주 1주당 120원의 현금배당을 결정했다...</td>
      <td>02100801.20200224163725001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>G-지배구조</td>
    </tr>
    <tr>
      <th>45877</th>
      <td>[코로나19 건강 지키기] 동화약품의 ‘판콜’은 지난해 매출 303억원을 기록한 ...</td>
      <td>02100311.20200326172754001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>47492</th>
      <td>조선이 대한제국을 선포하기 보름 전인 1897년 9월 25일, 우리나라 최초의 제...</td>
      <td>02100601.20200320001516001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-사회공헌</td>
    </tr>
    <tr>
      <th>62350</th>
      <td>동화약품이 회사의 신약후보물질 DW2008을 신종 코로나바이러스 감염증(코로나19...</td>
      <td>02100101.20200421102241001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>644089</th>
      <td>구강유산균 시장이 빠르게 성장하고 있다  코로나19의 확산과 일상화된 마스크 사용...</td>
      <td>02100311.20211116142132001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>648607</th>
      <td>[아시아경제 서소정 기자] 동화약품의 기능성 화장품 '후시드 크림'은 최근 각광받...</td>
      <td>02100801.20211123210051001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>655548</th>
      <td>롯데칠성음료의 ‘세상 맛있는 ZERO! 칠성사이다 ZERO!’편과 동화약품의 ‘달라...</td>
      <td>02100601.20211209160337001.txt</td>
      <td>5</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>658637</th>
      <td>[사진=게티이미지뱅크]   동화약품 주가가 상승 중이다   1일 한국거래소에 따르...</td>
      <td>02100851.20211201094104001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
    <tr>
      <th>668090</th>
      <td>[사진=게티이미지뱅크]   동화약품 주가가 상승 중이다   22일 한국거래소에 따...</td>
      <td>02100851.20211222141644001.txt</td>
      <td>0</td>
      <td>000020</td>
      <td>Neutral</td>
      <td>S-소비자</td>
    </tr>
  </tbody>
</table>
<p>176 rows × 6 columns</p>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 42.6 ms (started: 2022-12-29 13:40:31 +00:00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">esg_prediction_data</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2273
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time: 34.8 ms (started: 2022-12-29 13:40:31 +00:00)
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs/usecases/esg"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="prepare_datasets_for_labeling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Preparing active learning data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../esg-en/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ESG (English)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Young Joon Lee<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>